<!DOCTYPE html><html><head><meta charset="UTF-8"><meta content="minimum-scale=1.0, width=device-width" name="viewport"><meta name="description" content="Trigger Handlers"><title>Trigger Handlers - Trap.apex</title><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700|Roboto+Mono"><link rel="stylesheet" href="/trap-apex/vendor/galano/galano.css"><link rel="stylesheet" href="/trap-apex/vendor/icon-12/icon-12.css"><link rel="stylesheet" href="/trap-apex/vendor/senna/senna.css"><link rel="stylesheet" href="/trap-apex/vendor/icon-16/icon-16.css"><link rel="stylesheet" href="/trap-apex/vendor/codemirror/lib/codemirror.css"><link rel="stylesheet" href="/trap-apex/vendor/codemirror/theme/dracula.css"><script src="/trap-apex/js/bundles/shared.electric.js"></script><script src="/trap-apex/vendor/senna/senna.js"></script><script src="/trap-apex/vendor/codemirror/lib/codemirror.js"></script><script src="/trap-apex/vendor/codemirror/mode/css/css.js"></script><script src="/trap-apex/vendor/codemirror/mode/javascript/javascript.js"></script><script src="/trap-apex/vendor/codemirror/mode/xml/xml.js"></script><link rel="stylesheet" href="/trap-apex/styles/main.css"></head><body data-senna=""><div data-senna-surface="" id="wrapper"><div class="senna-loading-bar"></div><div id="pageComponent"><div class="main"><main class="guide"><div class="docs"><nav class="topbar topbar-light topbar-docs"><div class="topbar-logo"><a class="topbar-logo-link" href="/trap-apex"><span class="topbar-logo-icon icon-16-hammer"></span><h3 class="topbar-logo-text">Trap.apex</h3></a></div><nav class="topbar-menu"><button class="topbar-toggle">Menu</button><ul class="topbar-list"><li class="topbar-item"><a class="topbar-link topbar-link-selected" href="/trap-apex/docs/" target="undefined"><span>Docs</span></a></li><li class="topbar-item"><a class="topbar-link " href="/trap-apex/tutorials/getting_started/step_1.html" target="undefined"><span>Tutorials</span></a></li></ul></nav></nav><nav class="sidebar"><a class="sidebar-header toggler-header-collapsed"><span class="sidebar-icon icon-16-menu"></span><span>Docs Menu</span><span class="sidebar-icon-right"><span class="icon-12-arrow-down-short"></span><span class="icon-12-arrow-up-short"></span></span></a><div class="sidebar-toggler-content toggler-collapsed"><div class="sidebar-search"><div class="page-autocomplete"><div class="form-group"><div class="input-inner-addon input-inner-addon-right"><input autocomplete="off" class="form-control" name="q" placeholder="Search Docs" ref="input" required="" type="text"><span class="input-inner-icon-helper icon-16-magnifier"></span></div></div></div></div><nav class=""><ul class="sidebar-list sidebar-list-1"><li class="sidebar-item active"><a class="sidebar-link sidebar-link-selected" href="/trap-apex/docs/Trigger_Handler/"><span class="sidebar-icon icon-16-flash"></span><span>Trigger Handlers</span></a></li><li class="sidebar-item"><a class="sidebar-link " href="/trap-apex/docs/Trigger_Execution/"><span class="sidebar-icon icon-16-code-file"></span><span>Trigger Execution</span></a><nav class=""><ul class="sidebar-list sidebar-list-1"><li class="sidebar-item"><a class="sidebar-link " href="/trap-apex/docs/Trigger_Execution/bulk_object.html"><span class="sidebar-icon icon-16-code-file"></span><span>Bulk Objects</span></a></li><li class="sidebar-item"><a class="sidebar-link " href="/trap-apex/docs/Trigger_Execution/function.html"><span class="sidebar-icon icon-16-code-file"></span><span>Functions</span></a></li><li class="sidebar-item"><a class="sidebar-link " href="/trap-apex/docs/Trigger_Execution/data_sharing.html"><span class="sidebar-icon icon-16-code-file"></span><span>Data Sharing</span></a></li></ul></nav></li><li class="sidebar-item"><a class="sidebar-link " href="/trap-apex/docs/Trigger_Controller/"><span class="sidebar-icon icon-16-cloud"></span><span>Trigger Controller</span></a></li></ul></nav></div></nav><div class="sidebar-offset"><header class="guide-header"><div class="container-hybrid"><h1 class="title">Trigger Handlers Guide</h1></div></header><div class="container-hybrid"><div class="docs-guide row"><div class="docs-content col-xs-16 col-md-9"><div class="guide-content"><h6>Trigger Handlers</h6><article id="1"><h2>What is a Trigger Handler?</h2><p>A trigger handler is an object that processes the trigger logic.</p><p>Following the trigger best practices, we separate the logic from triggers into trigger handlers.</p><p>First, we delegate the logic from within triggers to trigger handlers.</p><div class="code-container"><button class="btn btn-sm btn-copy"><span class="icon-12-overlap"></span></button><pre><code class="code" data-mode="javascript" ref="code">trigger CaseTrigger on Case (
    before insert,
    before update,
    before delete,
    after insert,
    after update,
    after delete,
    after undelete
) {
    Trap.getInstance().start(); // Start the trap
}</code></pre></div><p>Here we get the instance of <code>Trap</code>, which is a trigger handler controller, and it will manage the lifecycle of trigger handlers and delegate the trigger execution context to the trigger handler.</p><p>Then we create a trigger handler like this:</p><div class="code-container"><button class="btn btn-sm btn-copy"><span class="icon-12-overlap"></span></button><pre><code class="code" data-mode="javascript" ref="code">public with sharing class CaseTrigger extends Trap.TriggerHandler {
    public override void setUpBeforeInsert(Trap.BulkObject bulkObj) {
        bulkObj.newStream
            .filter(new CustomFilterFunc())
            .subscribe(Trap.F.addError.apply('test error'));
    }
}</code></pre></div><p>For details on the streams and bulk objects here, please check out 'Trigger Execution' section.</p></article><article id="2"><h2>Trigger Context</h2><p>One of the key concepts in Trap.apex is that we use separate trigger contexts from the standard Salesforce trigger contexts. This means that we no longer have direct dependencies over Salesforce apex API, which further enables us to do our unit test simply, as we have complete control of our data.</p><p>Normally we bootstrap Trap.apex like this:</p><div class="code-container"><button class="btn btn-sm btn-copy"><span class="icon-12-overlap"></span></button><pre><code class="code" data-mode="javascript" ref="code">Trap.getInstance().start(); // Start the trap</code></pre></div><p>And we can also explicitly set the trigger context data during the bootstrap.</p><div class="code-container"><button class="btn btn-sm btn-copy"><span class="icon-12-overlap"></span></button><pre><code class="code" data-mode="javascript" ref="code">Trap.getInstance().start(Trap.Event.BeforeInsert, null, new List<sobject>{ new Case() });</sobject></code></pre></div><p>So we can easily control the trigger event, old list and new list passed into the trigger context.</p><p>And we apply that into the unit testing.</p><div class="code-container"><button class="btn btn-sm btn-copy"><span class="icon-12-overlap"></span></button><pre><code class="code" data-mode="javascript" ref="code">@isTest
private static void contextTest() {
    // test code

    Trap.getInstance().start(Trap.Event.BeforeInsert, null, new List<sobject>{ new Case() });

    // test code
}</sobject></code></pre></div><p>What we need to bear in mind is that in our code, do not use code like <code>Trigger.Xxx</code>. Instead, use this:</p><div class="code-container"><button class="btn btn-sm btn-copy"><span class="icon-12-overlap"></span></button><pre><code class="code" data-mode="javascript" ref="code">Trap.Context triggerContext = this.getTriggerContext();
Map<id, sobject=""> newMap = triggerContext.newMap;
List<sobject> newList = triggerContext.newList;</sobject></id,></code></pre></div><p>Methods are below:</p><table><thead><tr><th>Method</th><th>Description</th></tr></thead><tbody><tr><td>Trap.Context Trap.TriggerHandler.getTriggerContext()</td><td>Get the trigger context</td></tr><tr><td>Boolean Trap.TriggerHandler.isActive()</td><td>Check if the trigger handler is active</td></tr><tr><td>void Trap.TriggerHandler.run()</td><td>Run the trigger handler with default values from the real trigger context</td></tr><tr><td>void Trap.TriggerHandler.run(Trap.Event, List<sobject>, List<sobject>)</sobject></sobject></td><td>Run the trigger handler with the trigger event, old list and new list</td></tr></tbody></table></article><article id="3"><h2>Trigger Event</h2><p>Trap.apex categorizes trigger events into:</p><ul><li>BeforeInsert</li><li>BeforeUpdate</li><li>BeforeDelete</li><li>AfterInsert</li><li>AfterUpdate</li><li>AfterDelete</li><li>AfterUndelete</li><li>All</li></ul><p>All these events can be found in <code>Trap.Event</code>. <code>Trap.Event.All</code> is a special event used to denote accepting all events, and normally users should not use this event.</p></article><article id="4"><h2>Trigger Handler Styles</h2><p>Trap.apex is designed to be able to run in multiple styles.</p><ul><li><p>Streamed Style The streamed style adopts streams from Stream.apex to handle trigger logic and make codes more reusable and declarative.</p></li><li><p>Normal Style The normal style is like many other trigger frameworks that provide trigger event handling methods for you to override.</p></li><li><p>Integration Style The integration style enables you to use the streamed style inside an existing trigger framework.</p></li></ul></article><article id="5"><h2>Streamed Style</h2><p>The streamed style is distinct by using streams.</p><div class="code-container"><button class="btn btn-sm btn-copy"><span class="icon-12-overlap"></span></button><pre><code class="code" data-mode="javascript" ref="code">public with sharing class CaseTrigger extends Trap.TriggerHandler {
    public override void setUpBeforeInsert(Trap.BulkObject bulkObj) {
        bulkObj.newStream
            .filter(new CustomFilterFunc())
            .subscribe(Trap.F.addError.apply('test error'));
    }
}</code></pre></div><p>Methods are below:</p><table><thead><tr><th>Method</th><th>Description</th></tr></thead><tbody><tr><td>setUpBeforeInsert(Trap.BulkObject)</td><td>Set up before insert</td></tr><tr><td>setUpBeforeUpdate(Trap.BulkObject)</td><td>Set up before update</td></tr><tr><td>setUpBeforeDelete(Trap.BulkObject)</td><td>Set up before delete</td></tr><tr><td>setUpAfterInsert(Trap.BulkObject)</td><td>Set up after insert</td></tr><tr><td>setUpAfterUpdate(Trap.BulkObject)</td><td>Set up after update</td></tr><tr><td>setUpAfterDelete(Trap.BulkObject)</td><td>Set up after delete</td></tr><tr><td>setUpAfterUndelete(Trap.BulkObject)</td><td>Set up after undelete</td></tr><tr><td>setUp(Trap.BulkObject)</td><td>Set up all events</td></tr></tbody></table><p>We can use <code>setUp</code> to catch all events.</p><div class="code-container"><button class="btn btn-sm btn-copy"><span class="icon-12-overlap"></span></button><pre><code class="code" data-mode="javascript" ref="code">public with sharing class CaseTrigger extends Trap.TriggerHandler {
    public override void setUp(Trap.BulkObject bulkObj) {
        bulkObj.newStream
            .filter((Func)R.anyPass.run(
                Trap.F.isBeforeInsert,
                Trap.F.isBeforeUpdate
            ))
            .subscribe(Trap.F.addError.apply('Cannot do this'));
    }
}</code></pre></div></article><article id="6"><h2>Normal Style</h2><p>The normal style works just like other trigger frameworks.</p><div class="code-container"><button class="btn btn-sm btn-copy"><span class="icon-12-overlap"></span></button><pre><code class="code" data-mode="javascript" ref="code">public with sharing class CaseTrigger extends Trap.TriggerHandler {
    public override void bulkBefore() {
        // Custom code
    }

    public override void beforeInsert(SObject newSO) {
        Trap.Context triggerContext = this.getTriggerContext();
        // Custom code
    }
}</code></pre></div><p>Methods are below:</p><table><thead><tr><th>Method</th><th>Description</th></tr></thead><tbody><tr><td>bulkBefore()</td><td>Called before the before events</td></tr><tr><td>buldAfter()</td><td>Called before the after events</td></tr><tr><td>beforeInsert(SObject)</td><td>Called on before insert</td></tr><tr><td>beforeUpdate(SObject, SObject)</td><td>Called on before update</td></tr><tr><td>beforeDelete(SObject)</td><td>Called on before delete</td></tr><tr><td>afterInsert(SObject)</td><td>Called on after insert</td></tr><tr><td>afterUpdate(SObject, SObject)</td><td>Called on after update</td></tr><tr><td>afterDelete(SObject)</td><td>Called on after delete</td></tr><tr><td>afterUndelete(SObject)</td><td>Called on after undelete</td></tr></tbody></table></article><article id="7"><h2>Integration Style</h2><p>The integration style enables you to use Trap.apex inside your existing trigger framework.</p><div class="code-container"><button class="btn btn-sm btn-copy"><span class="icon-12-overlap"></span></button><pre><code class="code" data-mode="javascript" ref="code">public with sharing class CaseTrigger extends Other.TriggerHandler {
    private Trap.TriggerHandler handler = new Trap.TriggerHandler();

    public CaseTrigger() {
        handler.onBeforeInsert().newStream
            .tap(R.debug.apply('before insert'))
            .subscribe(Trap.F.addError.apply('test error'));
    }

    public override void beforeInsert(SObject newSO) {
        handler.run();
    }
}</code></pre></div><p>Methods are below:</p><table><thead><tr><th>Method</th><th>Description</th></tr></thead><tbody><tr><td>Trap.BulkObject onBeforeInsert()</td><td>Get the before insert bulk object</td></tr><tr><td>Trap.BulkObject onBeforeUpdate()</td><td>Get the before update bulk object</td></tr><tr><td>Trap.BulkObject onBeforeDelete()</td><td>Get the before delete bulk object</td></tr><tr><td>Trap.BulkObject onAfterInsert()</td><td>Get the after insert bulk object</td></tr><tr><td>Trap.BulkObject onAfterUpdate()</td><td>Get the after update bulk object</td></tr><tr><td>Trap.BulkObject onAfterDelete()</td><td>Get the after delete bulk object</td></tr><tr><td>Trap.BulkObject onAfterUndelete()</td><td>Get the after undelete bulk object</td></tr><tr><td>Trap.BulkObject onEvent()</td><td>Get the bulk object for all events</td></tr></tbody></table></article><input type="hidden" value="Trigger Handlers"><input type="hidden" value="Trap.apex"></div><div class="contribute"><div class="contribute-img"><span class="icon-16-github"></span></div><div class="contribute-text"><p>Contribute on Github! <a href="https://github.com/Click-to-Cloud/Trap.apex/tree/master/src/pages/docs/Trigger_Handler/index.md" class="contribute-link" target="_blank">Edit this section</a>.</p></div></div></div><nav class="col-xs-16 col-md-offset-2 col-md-5"><div class="docs-nav-container"><div class="affix-top docs-nav"><div ref="readingContainer"></div></div></div></nav></div></div></div></div></main></div></div><script src="/trap-apex/js/bundles/KCkzp.js"></script><script>var data = '{"pageLocation":"index.children.docs.children.Trigger_Handler","site":{"title":"Trap.apex","githubRepo":"Click-to-Cloud/Trap.apex","googleAnalytics":"","index":{"title":"Home","description":" Trap.apex is a versatile functional reactive library to handle Salesforce triggers.","srcFilePath":"src/pages/index.soy","id":"pages","location":"/./","url":"/trap-apex/./","children":{"docs":{"title":"Docs","description":"Everything you need to know to get started.","srcFilePath":"src/pages/docs/index.soy","id":"docs","location":"/docs/","url":"/trap-apex/docs/","children":{"search":{"title":"Search","description":"Find what you\'re looking for in the documentation.","hidden":true,"srcFilePath":"src/pages/docs/search.soy","id":"search","location":"/docs/search.html","url":"/trap-apex/docs/search.html"},"Trigger_Controller":{"title":"Trigger Controller","description":"Trigger Controller","layout":"guide","icon":"cloud","weight":4,"srcFilePath":"src/pages/docs/Trigger_Controller/index.md","id":"Trigger_Controller","location":"/docs/Trigger_Controller/","url":"/trap-apex/docs/Trigger_Controller/"},"Trigger_Execution":{"children":{"bulk_object":{"title":"Bulk Objects","description":"Bulk Objects","layout":"guide","icon":"code-file","weight":2,"srcFilePath":"src/pages/docs/Trigger_Execution/bulk_object.md","id":"bulk_object","location":"/docs/Trigger_Execution/bulk_object.html","url":"/trap-apex/docs/Trigger_Execution/bulk_object.html"},"data_sharing":{"title":"Data Sharing","description":"Data Sharing","layout":"guide","icon":"code-file","weight":4,"srcFilePath":"src/pages/docs/Trigger_Execution/data_sharing.md","id":"data_sharing","location":"/docs/Trigger_Execution/data_sharing.html","url":"/trap-apex/docs/Trigger_Execution/data_sharing.html"},"function":{"title":"Functions","description":"Functions","layout":"guide","icon":"code-file","weight":3,"srcFilePath":"src/pages/docs/Trigger_Execution/function.md","id":"function","location":"/docs/Trigger_Execution/function.html","url":"/trap-apex/docs/Trigger_Execution/function.html"}},"title":"Trigger Execution","description":"Trigger Execution","layout":"guide","icon":"code-file","weight":2,"srcFilePath":"src/pages/docs/Trigger_Execution/index.md","id":"Trigger_Execution","location":"/docs/Trigger_Execution/","url":"/trap-apex/docs/Trigger_Execution/","childIds":["bulk_object","function","data_sharing"]},"Trigger_Handler":{"title":"Trigger Handlers","description":"Trigger Handlers","layout":"guide","icon":"flash","weight":1,"srcFilePath":"src/pages/docs/Trigger_Handler/index.md","id":"Trigger_Handler","location":"/docs/Trigger_Handler/","url":"/trap-apex/docs/Trigger_Handler/","active":true}},"childIds":["Trigger_Handler","Trigger_Execution","Trigger_Controller","search"],"active":true},"tutorials":{"title":"Tutorials","description":"The tutorials","url":"/trap-apex/tutorials/getting_started/step_1.html","layout":false,"srcFilePath":"src/pages/tutorials/index.soy","id":"tutorials","location":"/tutorials/","customURL":true,"children":{"getting_started":{"title":"Getting Started","description":"The Getting Started Tutorial","tutorialTitle":"Getting started with Trap.apex","url":"/trap-apex/tutorials/getting_started/step_1.html","layout":false,"srcFilePath":"src/pages/tutorials/getting_started/index.soy","id":"getting_started","location":"/tutorials/getting_started/","customURL":true,"children":{"step_1":{"title":"Installation","description":"Include Apex files","buttonTitle":"Done","parentId":"getting_started","layout":"tutorial","time":90,"weight":1,"srcFilePath":"src/pages/tutorials/getting_started/step_1.md","id":"step_1","location":"/tutorials/getting_started/step_1.html","url":"/trap-apex/tutorials/getting_started/step_1.html"},"step_10":{"title":"Normal Trigger Event Handler","description":"Normal Trigger Event Handler","buttonTitle":"Done","parentId":"getting_started","layout":"tutorial","time":90,"weight":10,"srcFilePath":"src/pages/tutorials/getting_started/step_10.md","id":"step_10","location":"/tutorials/getting_started/step_10.html","url":"/trap-apex/tutorials/getting_started/step_10.html"},"step_11":{"title":"Trigger Context","description":"Trigger Context","buttonTitle":"Done","parentId":"getting_started","layout":"tutorial","time":90,"weight":11,"srcFilePath":"src/pages/tutorials/getting_started/step_11.md","id":"step_11","location":"/tutorials/getting_started/step_11.html","url":"/trap-apex/tutorials/getting_started/step_11.html"},"step_12":{"title":"Unit Test","description":"Unit Test","buttonTitle":"Done","parentId":"getting_started","layout":"tutorial","time":90,"weight":12,"srcFilePath":"src/pages/tutorials/getting_started/step_12.md","id":"step_12","location":"/tutorials/getting_started/step_12.html","url":"/trap-apex/tutorials/getting_started/step_12.html"},"step_13":{"title":"Take Only Trigger Execution","description":"Take Only Trigger Execution","buttonTitle":"Done","parentId":"getting_started","layout":"tutorial","time":90,"weight":13,"srcFilePath":"src/pages/tutorials/getting_started/step_13.md","id":"step_13","location":"/tutorials/getting_started/step_13.html","url":"/trap-apex/tutorials/getting_started/step_13.html"},"step_2":{"title":"Preliminary Knowledge","description":"Preliminary Knowledge","buttonTitle":"Done","parentId":"getting_started","layout":"tutorial","time":90,"weight":2,"srcFilePath":"src/pages/tutorials/getting_started/step_2.md","id":"step_2","location":"/tutorials/getting_started/step_2.html","url":"/trap-apex/tutorials/getting_started/step_2.html"},"step_3":{"title":"Create Triggers","description":"Create Triggers","buttonTitle":"Done","parentId":"getting_started","layout":"tutorial","time":90,"weight":3,"srcFilePath":"src/pages/tutorials/getting_started/step_3.md","id":"step_3","location":"/tutorials/getting_started/step_3.html","url":"/trap-apex/tutorials/getting_started/step_3.html"},"step_4":{"title":"Trigger Handler","description":"Trigger Handler","buttonTitle":"Done","parentId":"getting_started","layout":"tutorial","time":90,"weight":4,"srcFilePath":"src/pages/tutorials/getting_started/step_4.md","id":"step_4","location":"/tutorials/getting_started/step_4.html","url":"/trap-apex/tutorials/getting_started/step_4.html"},"step_5":{"title":"Bulk Object","description":"Bulk Object","buttonTitle":"Done","parentId":"getting_started","layout":"tutorial","time":90,"weight":5,"srcFilePath":"src/pages/tutorials/getting_started/step_5.md","id":"step_5","location":"/tutorials/getting_started/step_5.html","url":"/trap-apex/tutorials/getting_started/step_5.html"},"step_6":{"title":"Find Specific Objects","description":"Find Specific Objects","buttonTitle":"Done","parentId":"getting_started","layout":"tutorial","time":90,"weight":6,"srcFilePath":"src/pages/tutorials/getting_started/step_6.md","id":"step_6","location":"/tutorials/getting_started/step_6.html","url":"/trap-apex/tutorials/getting_started/step_6.html"},"step_7":{"title":"Data Sharing","description":"Data Sharing","buttonTitle":"Done","parentId":"getting_started","layout":"tutorial","time":90,"weight":7,"srcFilePath":"src/pages/tutorials/getting_started/step_7.md","id":"step_7","location":"/tutorials/getting_started/step_7.html","url":"/trap-apex/tutorials/getting_started/step_7.html"},"step_8":{"title":"Catch All Events","description":"Catch All Events","buttonTitle":"Done","parentId":"getting_started","layout":"tutorial","time":90,"weight":8,"srcFilePath":"src/pages/tutorials/getting_started/step_8.md","id":"step_8","location":"/tutorials/getting_started/step_8.html","url":"/trap-apex/tutorials/getting_started/step_8.html"},"step_9":{"title":"Trigger Controller","description":"Trigger Controller","buttonTitle":"Done","parentId":"getting_started","layout":"tutorial","time":90,"weight":9,"srcFilePath":"src/pages/tutorials/getting_started/step_9.md","id":"step_9","location":"/tutorials/getting_started/step_9.html","url":"/trap-apex/tutorials/getting_started/step_9.html"}},"childIds":["step_1","step_2","step_3","step_4","step_5","step_6","step_7","step_8","step_9","step_10","step_11","step_12","step_13"]}},"childIds":["getting_started"]}},"childIds":["docs","tutorials"]},"basePath":"/trap-apex","topbar":[{"href":"/trap-apex/docs/","label":"Docs","selected":true},{"href":"/trap-apex/tutorials/getting_started/step_1.html","label":"Tutorials"}]}}'; if (typeof electric !== 'undefined') {electric.init(data);}else {document.addEventListener('DOMContentLoaded', function() {electric.init(data);});}</script></div><script data-senna-track="permanent" src="/trap-apex/js/electric/electric.js"></script></body></html>